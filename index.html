<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F1 2025 Kalender & TV-Zeiten</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #121212;
            --card-bg-color: #1e1e1e;
            --primary-text-color: #e0e0e0;
            --secondary-text-color: #a0a0a0;
            --accent-color: #e10600; /* F1 Red */
            --sprint-accent-color: #00a1ff;
            --border-color: #333333;
            --shadow-color: rgba(0, 0, 0, 0.4);
        }

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-color);
            color: var(--primary-text-color);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            opacity: 0;
            animation: fadeIn 1s ease-in-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 1rem;
        }

        header h1 {
            font-size: 3rem;
            font-weight: 700;
            letter-spacing: 1px;
            color: var(--primary-text-color);
        }

        header h1 span {
            color: var(--accent-color);
        }

        .countdown-container {
            background: var(--card-bg-color);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            margin-bottom: 3rem;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 24px var(--shadow-color);
        }

        .countdown-container h2 {
            font-size: 1.2rem;
            font-weight: 300;
            color: var(--secondary-text-color);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 0.5rem;
        }

        .countdown-container h3 {
            font-size: 2.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--primary-text-color);
        }
        
        .countdown-container h3 .session-name {
            color: var(--accent-color);
        }

        #countdown {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .time-block {
            display: flex;
            flex-direction: column;
        }

        .time-block .value {
            font-size: 3rem;
            font-weight: 700;
            color: var(--primary-text-color);
            line-height: 1;
        }

        .time-block .label {
            font-size: 0.9rem;
            text-transform: uppercase;
            color: var(--secondary-text-color);
        }
        
        #local-time-info {
            margin-top: 1.5rem;
            font-size: 1rem;
            color: var(--primary-text-color);
        }
        
        #local-time-info strong {
            color: var(--accent-color);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        .race-card {
            background-color: var(--card-bg-color);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            padding: 1.5rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .race-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px var(--shadow-color);
        }
        
        .race-card.sprint-weekend {
            border-left: 5px solid var(--sprint-accent-color);
        }

        .race-card.past-event {
            opacity: 0.5;
            filter: grayscale(50%);
        }

        .card-header {
            margin-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1rem;
        }

        .card-header h4 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-text-color);
        }
        
        .card-header h4 .sprint-star {
            color: var(--sprint-accent-color);
            font-size: 1.2rem;
            margin-left: 0.25rem;
        }

        .card-header p {
            font-size: 0.9rem;
            color: var(--secondary-text-color);
        }
        
        .sessions-list {
            list-style: none;
            flex-grow: 1;
        }

        .sessions-list li {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #2a2a2a;
        }
        
        .sessions-list li:last-child {
            border-bottom: none;
        }
        
        .sessions-list li span:first-child {
            font-weight: 600;
            color: var(--primary-text-color);
        }

        .sessions-list li span:last-child {
            font-weight: 400;
            color: var(--secondary-text-color);
            text-align: right;
        }
        
        footer {
            text-align: center;
            margin-top: 4rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
            color: var(--secondary-text-color);
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            header h1 {
                font-size: 2.2rem;
            }
            .countdown-container h3 {
                font-size: 1.8rem;
            }
            #countdown .value {
                font-size: 2rem;
            }
        }
        
        @media (max-width: 480px) {
            .calendar-grid {
                grid-template-columns: 1fr;
            }
        }

    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>F1 Kalender <span>2025</span></h1>
        </header>

        <section class="countdown-container">
            <h2 id="next-session-title">Nächste Session</h2>
            <h3 id="next-session-name">Lade Daten...</h3>
            <div id="countdown">
                <div class="time-block">
                    <span id="days" class="value">--</span>
                    <span class="label">Tage</span>
                </div>
                <div class="time-block">
                    <span id="hours" class="value">--</span>
                    <span class="label">Stunden</span>
                </div>
                <div class="time-block">
                    <span id="minutes" class="value">--</span>
                    <span class="label">Minuten</span>
                </div>
                <div class="time-block">
                    <span id="seconds" class="value">--</span>
                    <span class="label">Sekunden</span>
                </div>
            </div>
            <p id="local-time-info"></p>
        </section>

        <main class="calendar-grid" id="calendar-grid">
            <!-- Race cards will be injected here by JavaScript -->
        </main>
        
        <footer>
            <p>Alle Zeiten werden automatisch in Ihre lokale Zeitzone umgerechnet. <br>Kalenderdaten basieren auf dem bereitgestellten CSV.</p>
        </footer>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const csvData = `
"Datum","Veranstaltung","Training 1","Training 2","Training 3","Qualifying","Sprint-Qualifying","Sprint","Rennen"
"14.–16. März","Australien (Melbourne)","Fr, 13:30 MEZ","Fr, 17:00 MEZ","Sa, 12:30 MEZ","Sa, 16:00 MEZ","–","–","So, 05:00 MEZ"
"21.–23. März","China (Shanghai) ★","Fr, 04:30 MEZ","–","–","Fr, 08:30 MEZ","Sa, 04:00 MEZ","Sa, 08:00 MEZ","So, 08:00 MEZ"
"4.–6. April","Japan (Suzuka)","Fr, 03:30 MEZ","Fr, 07:00 MEZ","Sa, 03:30 MEZ","Sa, 07:00 MEZ","–","–","So, 07:00 MEZ"
"11.–13. April","Bahrain (Sakhir)","Fr, 12:30 MEZ","Fr, 16:00 MEZ","Sa, 13:30 MEZ","Sa, 17:00 MEZ","–","–","So, 17:00 MEZ"
"18.–20. April","Saudi-Arabien (Dschidda)","Fr, 14:30 MEZ","Fr, 18:00 MEZ","Sa, 15:30 MEZ","Sa, 19:00 MEZ","–","–","So, 19:00 MEZ"
"2.–4. Mai","Miami (USA) ★","Fr, 17:30 MEZ","–","–","Fr, 21:30 MEZ","Sa, 17:00 MEZ","Sa, 21:00 MEZ","So, 22:00 MEZ"
"16.–18. Mai","Emilia-Romagna (Imola)","Fr, 13:30 MEZ","Fr, 17:00 MEZ","Sa, 12:30 MEZ","Sa, 16:00 MEZ","–","–","So, 15:00 MEZ"
"23.–25. Mai","Monaco","Fr, 13:30 MEZ","Fr, 17:00 MEZ","Sa, 12:30 MEZ","Sa, 16:00 MEZ","–","–","So, 15:00 MEZ"
"30. Mai – 1. Juni","Spanien (Barcelona)","Fr, 13:30 MEZ","Fr, 17:00 MEZ","Sa, 12:30 MEZ","Sa, 16:00 MEZ","–","–","So, 15:00 MEZ"
"13.–15. Juni","Kanada (Montreal)","Fr, 19:30 MEZ","Fr, 23:00 MEZ","Sa, 18:30 MEZ","Sa, 22:00 MEZ","–","–","So, 20:00 MEZ"
"27.–29. Juni","Österreich (Spielberg)","Fr, 13:30 MEZ","Fr, 17:00 MEZ","Sa, 12:30 MEZ","Sa, 16:00 MEZ","–","–","So, 15:00 MEZ"
"4.–6. Juli","Großbritannien (Silverstone)","Fr, 12:30 MEZ","Fr, 16:00 MEZ","Sa, 11:30 MEZ","Sa, 15:00 MEZ","–","–","So, 16:00 MEZ"
"25.–27. Juli","Belgien (Spa) ★","Fr, 12:30 MEZ","–","–","Fr, 16:30 MEZ","Sa, 12:00 MEZ","Sa, 16:00 MEZ","So, 15:00 MEZ"
"1.–3. August","Ungarn (Budapest)","Fr, 13:30 MEZ","Fr, 17:00 MEZ","Sa, 12:30 MEZ","Sa, 16:00 MEZ","–","–","So, 15:00 MEZ"
"29.–31. August","Niederlande (Zandvoort)","Fr, 12:30 MEZ","Fr, 16:00 MEZ","Sa, 11:30 MEZ","Sa, 15:00 MEZ","–","–","So, 15:00 MEZ"
"5.–7. September","Italien (Monza)","Fr, 13:30 MEZ","Fr, 17:00 MEZ","Sa, 12:30 MEZ","Sa, 16:00 MEZ","–","–","So, 15:00 MEZ"
"19.–21. September","Aserbaidschan (Baku)","Fr, 10:30 MEZ","Fr, 14:00 MEZ","Sa, 10:30 MEZ","Sa, 14:00 MEZ","–","–","So, 13:00 MEZ"
"3.–5. Oktober","Singapur","Fr, 11:30 MEZ","Fr, 15:00 MEZ","Sa, 11:30 MEZ","Sa, 15:00 MEZ","–","–","So, 14:00 MEZ"
"17.–19. Oktober","USA (Austin) ★","Fr, 18:30 MEZ","–","–","Fr, 22:30 MEZ","Sa, 18:00 MEZ","Sa, 22:00 MEZ","So, 21:00 MEZ"
"24.–26. Oktober","Mexiko (Mexiko-Stadt)","Fr, 19:30 MEZ","Fr, 23:00 MEZ","Sa, 18:30 MEZ","Sa, 22:00 MEZ","–","–","So, 21:00 MEZ"
"7.–9. November","Brasilien (São Paulo) ★","Fr, 14:30 MEZ","–","–","Fr, 18:30 MEZ","Sa, 14:00 MEZ","Sa, 18:00 MEZ","So, 18:00 MEZ"
"21.–23. November","Las Vegas (USA)","Fr, 06:30 MEZ","Fr, 10:00 MEZ","Sa, 06:30 MEZ","Sa, 10:00 MEZ","–","–","So, 05:00 MEZ"
"28.–30. November","Katar (Lusail) ★","Fr, 12:30 MEZ","–","–","Fr, 16:30 MEZ","Sa, 12:00 MEZ","Sa, 16:00 MEZ","So, 17:00 MEZ"
"5.–7. Dezember","Abu Dhabi (Yas Marina)","Fr, 10:30 MEZ","Fr, 14:00 MEZ","Sa, 11:30 MEZ","Sa, 15:00 MEZ","–","–","So, 14:00 MEZ"
        `;

        const monthMap = { "Januar": 0, "Februar": 1, "März": 2, "April": 3, "Mai": 4, "Juni": 5, "Juli": 6, "August": 7, "September": 8, "Oktober": 9, "November": 10, "Dezember": 11 };
        const dayMap = { "Fr": 5, "Sa": 6, "So": 0 };
        const year = 2025; 

        function parseCSV(data) {
            const lines = data.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.replace(/"/g, ''));
            const rows = lines.slice(1).map(line => {
                const values = line.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g).map(v => v.replace(/"/g, '').trim());
                let rowData = {};
                headers.forEach((header, i) => {
                    rowData[header] = values[i];
                });
                return rowData;
            });
            return { headers, rows };
        }

        function createDateFromSession(dateString, sessionString) {
            if (!dateString || !sessionString || sessionString === '–') return null;

            // Parse Date Range: "14.–16. März" -> dayStart: 14, monthName: "März"
            const dateParts = dateString.match(/(\d+).*(?:\d+\.\s)?(.*)/);
            if (!dateParts) return null;
            const dayStart = parseInt(dateParts[1], 10);
            const monthName = dateParts[2].trim();
            const monthIndex = monthMap[monthName];

            // Parse Session: "Fr, 13:30 MEZ" -> sessionDay: "Fr", time: "13:30"
            const sessionParts = sessionString.match(/(\w+),\s(\d{2}:\d{2})/);
            if (!sessionParts) return null;
            const sessionDayAbbr = sessionParts[1];
            const time = sessionParts[2];
            
            // This is a simplified logic to find the correct date. It assumes Fr/Sa/So are sequential.
            let day = dayStart;
            if (sessionDayAbbr === 'Sa') day = dayStart + 1;
            if (sessionDayAbbr === 'So') day = dayStart + 2;

            // Handle month-crossing weekends (e.g., 30. Mai - 1. Juni)
            const dateForDayCalc = new Date(year, monthIndex, day);
            const actualDay = dateForDayCalc.getDate();
            const actualMonth = dateForDayCalc.getMonth();

            // Check for DST in Central Europe (MEZ/MESZ)
            // CET (MEZ) is UTC+1. CEST (MESZ) is UTC+2.
            // Switch is last Sunday of March and last Sunday of October.
            const tempDate = new Date(Date.UTC(year, actualMonth, actualDay, 12, 0, 0));
            const startDST = new Date(Date.UTC(year, 2, 31 - new Date(Date.UTC(year, 2, 31)).getUTCDay()));
            const endDST = new Date(Date.UTC(year, 9, 31 - new Date(Date.UTC(year, 9, 31)).getUTCDay()));
            const timeZoneOffset = (tempDate > startDST && tempDate < endDST) ? '+02:00' : '+01:00';

            const isoString = `${year}-${String(actualMonth + 1).padStart(2, '0')}-${String(actualDay).padStart(2, '0')}T${time}:00${timeZoneOffset}`;
            return new Date(isoString);
        }

        const { headers, rows } = parseCSV(csvData);
        const sessionHeaders = headers.slice(2);
        let allSessions = [];

        const raceData = rows.map(row => {
            const isSprint = row.Veranstaltung.includes('★');
            const raceName = row.Veranstaltung.replace(' ★', '');
            const sessions = {};
            let raceEndDate = null;

            sessionHeaders.forEach(header => {
                const sessionTime = row[header];
                if (sessionTime !== '–') {
                    const date = createDateFromSession(row.Datum, sessionTime);
                    sessions[header] = date;
                    if(date){
                        allSessions.push({
                            raceName: raceName,
                            sessionName: header,
                            date: date
                        });
                        if(header === "Rennen") {
                            raceEndDate = date;
                        }
                    }
                }
            });
            // if no race date, use the last available session date for past event check
            if (!raceEndDate) {
                const availableDates = Object.values(sessions).filter(Boolean).sort((a,b) => b - a);
                if (availableDates.length > 0) {
                    raceEndDate = availableDates[0];
                }
            }


            return {
                dateRange: row.Datum,
                name: raceName,
                isSprint,
                sessions,
                raceEndDate
            };
        });

        function updateCountdown() {
            const now = new Date();
            const futureSessions = allSessions.filter(s => s.date > now).sort((a, b) => a.date - b.date);

            if (futureSessions.length === 0) {
                document.getElementById('next-session-title').textContent = "Saison beendet";
                document.getElementById('next-session-name').textContent = "Wir sehen uns 2026!";
                document.getElementById('countdown').style.display = 'none';
                return;
            }

            const nextSession = futureSessions[0];
            const timeDiff = nextSession.date.getTime() - now.getTime();
            
            const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);

            document.getElementById('days').textContent = String(days).padStart(2, '0');
            document.getElementById('hours').textContent = String(hours).padStart(2, '0');
            document.getElementById('minutes').textContent = String(minutes).padStart(2, '0');
            document.getElementById('seconds').textContent = String(seconds).padStart(2, '0');
            
            document.getElementById('next-session-name').innerHTML = `${nextSession.raceName} - <span class="session-name">${nextSession.sessionName}</span>`;

            const localTimeOptions = { weekday: 'long', day: 'numeric', month: 'long', hour: '2-digit', minute: '2-digit', timeZoneName: 'short' };
            document.getElementById('local-time-info').innerHTML = `Startet am: <strong>${nextSession.date.toLocaleString(undefined, localTimeOptions)}</strong> (Ihre lokale Zeit)`;
        }

        function renderCalendar() {
            const grid = document.getElementById('calendar-grid');
            const now = new Date();
            const localTimeOptions = { weekday: 'short', hour: '2-digit', minute: '2-digit' };
            
            raceData.forEach(race => {
                const card = document.createElement('div');
                card.className = 'race-card';
                if (race.isSprint) card.classList.add('sprint-weekend');
                if (race.raceEndDate && race.raceEndDate < now) card.classList.add('past-event');

                const sessionItems = Object.entries(race.sessions)
                    .map(([name, date]) => {
                        if (!date) return '';
                        return `<li><span>${name}</span> <span>${date.toLocaleString(undefined, localTimeOptions)}</span></li>`;
                    })
                    .join('');

                card.innerHTML = `
                    <div class="card-header">
                        <h4>${race.name} ${race.isSprint ? '<span class="sprint-star">★</span>' : ''}</h4>
                        <p>${race.dateRange}</p>
                    </div>
                    <ul class="sessions-list">
                        ${sessionItems}
                    </ul>
                `;
                grid.appendChild(card);
            });
        }
        
        renderCalendar();
        updateCountdown();
        setInterval(updateCountdown, 1000);
    });
    </script>
</body>
</html>
